<ul>
<!--check url-->
  <li><a href="[~[+id+]~]#commonedits">Загальні налаштування для файлу .htaccess</a></li>
  <li><a href="[~[+id+]~]#adminprotection">Захист адмінки</a></li>
  <li><a href="[~[+id+]~]#sessionhandling">Керування сеансами</a></li>
  <li><a href="[~[+id+]~]#cssjsdocuments">Файли CSS і JS як документи Evo</a></li>
  <li><a href="[~[+id+]~]#timezone">Часовий пояс</a></li>
  <li><a href="[~[+id+]~]#defaultcharsets">Кодування символів за замовчуванням</a></li>
  <li><a href="[~[+id+]~]#registerglobals">Директива register_globals</a></li>
  <li><a href="[~[+id+]~]#solvingie">Розбираємося з примхами Internet Explorer</a></li>
</ul>
<h2>Налаштування файлу .htaccess для Evo для задіяння можливостей модуля Apache mod_rewrite</h2>
<p>Evo підтримує дружні URL завдяки файлу .htaccess з певними налаштуваннями. Щоб використовувати цей функціонал, ваш сайт повинен працювати на сервері Apache з включеним модулем mod_rewrite, також, звичайно, ім'я файлу треба змінити з ht.access на .htaccess. Нижче наведено рекомендований шаблон для додаткових налаштувань:</p>
<div><div id="highlighter_84127" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">Options +FollowSymlinks</code></div><div class="line number2 index1 alt1"><code class="php plain">RewriteEngine On</code></div><div class="line number3 index2 alt2"><code class="php plain">RewriteBase /</code></div><div class="line number4 index3 alt1"><code class="php plain"># Fix Apache internal dummy connections from breaking [(site_url)] cache</code></div><div class="line number5 index4 alt2"><code class="php plain">RewriteCond %{HTTP_USER_AGENT} ^.*internal\ dummy\ connection.*$ [NC]</code></div><div class="line number6 index5 alt1"><code class="php plain">RewriteRule .* - [F,L]</code></div><div class="line number7 index6 alt2"><code class="php plain"># Rewrite domain.com -&gt; www.domain.com -- used with SEO Strict URLs plugin</code></div><div class="line number8 index7 alt1"><code class="php plain">#RewriteCond %{HTTP_HOST} .</code></div><div class="line number9 index8 alt2"><code class="php plain">#RewriteCond %{HTTP_HOST} !^www\.example\.com [NC]</code></div><div class="line number10 index9 alt1"><code class="php plain">#RewriteRule (.*) http:</code><code class="php comments">//www.example.com/$1 [R=301,L]</code></div><div class="line number11 index10 alt2"><code class="php plain"># Exclude /assets </code><code class="php keyword">and</code> <code class="php plain">/manager directories from rewrite rules</code></div><div class="line number12 index11 alt1"><code class="php plain">RewriteRule ^(manager|assets) - [L]</code></div><div class="line number13 index12 alt2"><code class="php plain"># For Friendly URLs</code></div><div class="line number14 index13 alt1"><code class="php plain">RewriteCond %{REQUEST_FILENAME} !-f</code></div><div class="line number15 index14 alt2"><code class="php plain">RewriteCond %{REQUEST_FILENAME} !-d</code></div><div class="line number16 index15 alt1"><code class="php plain">RewriteRule ^(.*)$ index.php?q=</code><code class="php variable">$1</code> <code class="php plain">[L,QSA]</code></div><div class="line number17 index16 alt2"><code class="php plain"># Reduce server overhead by enabling output compression </code><code class="php keyword">if</code> <code class="php plain">supported.</code></div><div class="line number18 index17 alt1"><code class="php plain">#php_flag zlib.output_compression On</code></div><div class="line number19 index18 alt2"><code class="php plain">#php_value zlib.output_compression_level 5</code></div></div></td></tr></tbody></table></div></div>
<div class="note">Якщо ви використовуєте сервер IIS, дружні URL вам все одно будуть доступні, однак оптимальні рішення вимагають використання платних додаткових модулів для IIS.</div>
<h3 id="commonedits">Загальні налаштування для файлу .htaccess</h3>
<p>Перш за все, директива RewriteBase повинна вказувати на папку, в яку встановлена ​​Evo. Наприклад, якщо ви встановили Evo в підпапку "evo", для цієї директиви потрібно вказати значення "/evo":</p>
<div><div id="highlighter_447689" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteBase /evo</code></div></div></td></tr></tbody></table></div></div>
<p>Зверніть увагу, що в останньому блоці директив директиви стиснення gzip закоментовані, так як в деяких середовищах вони потенційно можуть викликати проблеми. Проте, для того, щоб веб-сервер працював швидше, останні два рядки слід розкоментувати, як показано нижче:</p>
<div><div id="highlighter_617416" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain"># Reduce server overhead by enabling output compression </code><code class="php keyword">if</code> <code class="php plain">supported.</code></div><div class="line number2 index1 alt1"><code class="php plain">php_flag zlib.output_compression On</code></div><div class="line number3 index2 alt2"><code class="php plain">php_value zlib.output_compression_level 5</code></div></div></td></tr></tbody></table></div></div>
<p>Вам також може знадобитися зробити ваші URL нечутливими до регістру, для цього слід додати до директиви, що знаходиться в секції "For Friendly URLs" (це директиви для управління дружніми URL), директиву NC:</p>
<div><div id="highlighter_682636" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteRule ^(.*)$ index.php?q=</code><code class="php variable">$1</code> <code class="php plain">[L,QSA,NC]</code></div></div></td></tr></tbody></table></div></div>
<p>Якщо ви віддаєте перевагу, щоб на вашому сайті до введених URL-адресами завжди додавався префікс "www.", Тобто щоб ваші URL завжди показувалися у вигляді "www.example.com", тоді нижченаведений розділ повинен бути змінений таким чином:</p>
<div><div id="highlighter_530777" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteCond %{HTTP_HOST} .</code></div><div class="line number2 index1 alt1"><code class="php plain">RewriteCond %{HTTP_HOST} !^www\.example\.com [NC]</code></div><div class="line number3 index2 alt2"><code class="php plain">RewriteRule (.*) http:</code><code class="php comments">//www.example.com/$1 [R=301,L]</code></div></div></td></tr></tbody></table></div></div>
<p>Якщо ви не використовуєте віртуальні домени і працюєте на локальному комп'ютері, або ви чекаєте оновлення DNS, тобто якщо для доступу до вашого сайту ви використовуєте URL виду "http://10.0.0.1/~myacct", правило перезапису URL слід переписати, як показано нижче. При цьому, коли ви перейдете на віддалений сервер, не забудьте відновити все, як було.</p>
<div><div id="highlighter_554723" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteCond %{REQUEST_FILENAME} !-f</code></div><div class="line number2 index1 alt1"><code class="php plain">RewriteCond %{REQUEST_FILENAME} !-d</code></div><div class="line number3 index2 alt2"><code class="php plain">RewriteRule ^(.*)$ /~myacct/index.php?q=</code><code class="php variable">$1</code> <code class="php plain">[L,QSA]</code></div></div></td></tr></tbody></table></div></div>
<h3 id="adminprotection">Захист адмінки</h3>
<p>Якщо ви хочете обмежити доступ до адмінки тільки конкретним IP-адресам, але при цьому вам потрібно дозволити доступ до компонентів, що належать до відкритої частини сайту, наприклад, до капчі, використовуйте наступні директиви. Ці директиви повинні бути поміщені в файл .htaccess, що знаходиться в папці адмінки:</p>
<div><div id="highlighter_16115" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain"># Дозволяємо доступ до адмінки тільки конкретним IP-адресам</code></div><div class="line number2 index1 alt1"><code class="php plain">Options +FollowSymlinks</code></div><div class="line number3 index2 alt2"><code class="php plain">RewriteEngine On</code></div><div class="line number4 index3 alt1"><code class="php plain"># Блокування по IP. Для IP-адрес, вказаних в списку, доступ буде відкритий.</code></div><div class="line number5 index4 alt2"><code class="php plain">RewriteCond %{REMOTE_ADDR} !^(192\.168\.0\.128)$</code></div><div class="line number6 index5 alt1"><code class="php plain">RewriteCond %{REQUEST_FILENAME} !/includes/veriword\.php$</code></div><div class="line number7 index6 alt2"><code class="php plain">RewriteRule ^(.*)$ index.php?q=</code><code class="php variable">$1</code> <code class="php plain">[L,QSA]</code></div></div></td></tr></tbody></table></div></div>
<div class="note">Перший рядок ("Options +FollowSymlinks") може знадобитися закомментування в деяких ситуаціях, де подібний рядок вже присутній в кореневій папці сайту, щоб уникнути помилок сервера.</div>
<h3 id="sessionhandling">Керування сеансами</h3>
<p>Якщо ваш сайт працює в середовищі, в якій мають місце проблеми, пов'язані з агресивним збиранням сміття, про що можуть свідчити несподівані і часті виходи з адмінки, то можна налаштувати місцезнаходження для файлів сеансів, щоб прибрати їх з глобальної та розділяється папки tmp/session, де вони знаходяться за замовчуванням:</p>
<div class="note">Якщо ви додали ці директиви до вашого файлу .htaccess, їх також треба додати в файл .htaccess, що знаходиться в папці адмінки.</div>
<div><div id="highlighter_468341" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">php_value session.save_path /path/to/your/web/content/sessions/</code></div><div class="line number2 index1 alt1"><code class="php plain">php_value session.gc_maxlifetime 28800</code></div></div></td></tr></tbody></table></div></div>
<h3 id="cssjsdocuments">и</h3>і<p>За замовчуванням .htaccess для Evo налаштований так, що він виключає зі сфери дії правил перезапису URL папку /assets і папку адмінки. Якщо у вас є документ Evo, який використовується як файл CSS, вам треба буде змінити один рядок, щоб дозволити перезапис URL в папці /assets, якщо ваш файл CSS знаходиться саме там.</p>
<div><div id="highlighter_136193" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteRule ^(manager|assets) - [L]</code></div></div></td></tr></tbody></table></div></div>
<p>Це слід змінити так</p>
<div><div id="highlighter_532608" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteRule ^manager - [L]</code></div></div></td></tr></tbody></table></div></div>
<div class="note"><strong>Підказки</strong><br>
<p>Якщо вам все-таки потрібно зберегти деякі папки як виключення, то правила перезапису можна відключити, наприклад, в папках /assets/images і /assets/snippets за допомогою наступної директиви:</p>
  <div><div id="highlighter_110968" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">RewriteRule ^(manager|assets/images|assets/snippets) - [L]</code></div></div></td></tr></tbody></table></div></div>
</div>
<h3 id="timezone">Часовий пояс</h3>
<p>На деяких серверах можуть бути не налаштовані часові пояси, що може викликати проблеми. Можна спробувати налаштувати часовий пояс наступним чином (повний список підтримуваних часових поясів знаходиться <a target="_blank" rel="nofollow" href="//php.net/manual/en/timezones.php">тут</a>).</p>
<div><div id="highlighter_982415" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">php_value </code><code class="php functions">date</code><code class="php plain">.timezone Europe/Moscow</code></div></div></td></tr></tbody></table></div></div>
<p>або</p>
<div><div id="highlighter_792991" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">SetEnv TZ America/Chicago</code></div></div></td></tr></tbody></table></div></div>
<h3 id="defaultcharsets">Кодування символів за замовчуванням</h3>
<p>В принципі, щоб коректно обробляти символьні кодування, вам потрібно відповідним чином виправити ваш код і базу даних. Однак якщо вам дуже хочеться, то ви можете прочитати довідку про директиву <a target="_blank" rel="nofollow" href="//httpd.apache.org/docs/2.0/mod/core.html#adddefaultcharset">AddDefaultCharset</a> і подумати про використання цієї директиви в наступному вигляді:</p>
<div><div id="highlighter_802383" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">AddDefaultCharset utf-8</code></div></div></td></tr></tbody></table></div></div>
<h3 id="registerglobals">Директива register_globals</h3>
<div class="warning"><strong>Попередження</strong><br>
<p>Якщо у вашого сервера включена директива register_globals (і відключити її неможливо), біжіть звідси на новий хостинг якомога швидше. Так-так, серйозно.</p>
<p><strong>Починаючи з Evo версії 1.2.1, директива register_globals на вашому сервері повинна бути відключена, інакше Evo не працюватиме.</strong></p>
</div>
<p>Якщо директива register_globals включена, то ваш сайт практично зі стовідсотковою ймовірністю рано чи пізно буде зламаний, а якщо він перебуває на розділеному хостингу, так тим більше. Це все одно, що дати маленькій дитині погратися з зарядженим пістолетом і сподіватися, що він не натисне на курок. Якщо ви платите за хостинг менше 15 доларів на місяць, значить, ваш хостинг розділяється. Детальніше про директиву register_globals див. <a target="_blank" rel="nofollow" href="//php.net/register_globals">тут</a>.</p>
<p>Щоб перевірити, що ця директива відключена, відкрийте адмінку, потім увійдіть в меню "Система" і виберіть пункт "Системна інформація", потім на сторінці яка відкрилася, виберіть посилання phpinfo (). На сторінці, що відкрилася за цим посиланням, знайдіть інформацію про директиву register_globals. Її локальне значення має бути OFF. Якщо ж її основне значення дорівнює OFF, то турбуватися з приводу цієї директиви вам не потрібно.</p>
<p><strong>Якщо директива register_globals викликає помилку сервера 500:</strong></p>
<p>Це означає, що ваш сервер забороняє встановлювати директиви PHP в файлі .htaccess. У цьому випадку відповідні зміни треба внести безпосередньо в файл php.ini. Якщо ви використовуєте платний хостинг, зв'яжіться з його техпідтримкою, щоб вони це зробили. Треба сказати, що не всі сервери дозволяють використовувати локальні файли php.ini, до того ж, вони повинні містити всі налаштування PHP (а не тільки цю), інакше всі не вказані директиви PHP будуть встановлені в значеннях за замовчуванням. Детальніше про встановлення директив PHP див. На сайті www.php.net.</p>
<div><div id="highlighter_185869" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain"># Отключаем register_globals, так як у нас корявий хостинг, що не піклується про безпеку</code></div><div class="line number2 index1 alt1"><code class="php plain">php_flag register_globals Off</code></div></div></td></tr></tbody></table></div></div>
<h3 id="solvingie">Розбираємося з примхами Internet Explorer</h3>
<p>Якщо на вашому сайті використовуються файли .htc, то деякі сервери можуть їх віддавати з неправильним MIME-типом. Щоб вирішити цю проблему, можна додати наступний рядок. Це критично важливо для користувачів MS Windows XP SP2:</p>
<div><div id="highlighter_11284" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain"># Налаштовуємо MIME-тип для файлів .htc</code><code class="php keyword">для</code> <code class="php plain">Internet Explorer</code></div><div class="line number2 index1 alt1"><code class="php plain">AddType text/x-component .htc</code></div></div></td></tr></tbody></table></div></div>
<p>Наступні директиви дозволяють ліквідувати мерехтіння екрану при використанні IE в разі накладення різних файлів CSS. Після того, як ви їх введете, вам може знадобитися примусове перезавантаження сторінки, щоб побачити зміни.</p>
<div><div id="highlighter_926771" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain"># Виправляємо мерехтіння екрану</code><code class="php keyword">для</code> <code class="php plain">Internet Explorer</code></div><div class="line number2 index1 alt1"><code class="php plain">ExpiresActive On</code></div><div class="line number3 index2 alt2"><code class="php plain">ExpiresByType image/gif A2592000</code></div><div class="line number4 index3 alt1"><code class="php plain">ExpiresByType image/jpeg A2592000</code></div><div class="line number5 index4 alt2"><code class="php plain">ExpiresByType image/png A2592000</code></div><div class="line number6 index5 alt1"><code class="php plain">BrowserMatch </code><code class="php string">"MSIE"</code> <code class="php plain">brokenvary=1</code></div><div class="line number7 index6 alt2"><code class="php plain">BrowserMatch </code><code class="php string">"Mozilla/4.[0-9]{2}"</code> <code class="php plain">brokenvary=1</code></div><div class="line number8 index7 alt1"><code class="php plain">BrowserMatch </code><code class="php string">"Opera"</code> <code class="php plain">!brokenvary</code></div><div class="line number9 index8 alt2"><code class="php plain">SetEnvIf brokenvary 1 force-no-vary</code></div></div></td></tr></tbody></table></div></div>
<div class="note">Файли .htaccess дають можливість налаштовувати конфігурацію сервера на рівні окремої папки, якщо у вас немає доступу до головного конфігураційного файлу сервера Apache httpd.conf. Взагалі-то, при кожній можливості для директив сервера слід використовувати головний конфігураційний файл, так як використання файлів .htaccess призводить до збільшення часу обробки сторінок сайту.</div>
