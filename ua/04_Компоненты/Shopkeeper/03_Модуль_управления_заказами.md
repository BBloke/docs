Керування замовленнями інтернет-магазину
## Функції ##
- Редагування і видалення замовлень, що надійшли;
- Можливість встановити замовленню статус (новий, в процесі виконання, відісланий, виконаний, виникли проблеми);
- Можливість писати нотатки до кажного замовлення;
- Сортування замовлень.
- Керування товарами в каталозі (створення, редагування).

## Конфігурація ##
- **Замовлень на сторінці** -  число замовлень в списку на одній сторінці.
- **Валюта** - впливає на відображення в таблиці замовлень і докладної информації про замовлення.
- **Кольори статусів** - кольори рядків в таблиці заказов, відповідні статусам замовлень. Назви статусів можна міняти в мовному файлі `shopkeeper/lang/lang_ru.php`
- **Облік товару на складі** - ім'я TV-параметра, який використовується для обліку кількості товарів на складі. Докладніше нижче.
- **Категорія каталогу за замовчуванням** - Вкажіть ID документа, який буде використовуватися для каталогу за замовчуванням. У модулі з'явиться кнопка для переходу в каталог. Необхідно також налаштувати плагін SaveToSHK.
- **Скасовувати замовлення через, день/дні** - якщо замовлення знаходиться в статусі "Прийнято до оплати" більше днів, він скасовується.
- **ID TV-параметру ціни** - потрібно для каталогу Shopkeeper.
- **Відправляти покупцеві ел. листи при зміні статусу замовлення** - листи відправляються при переведенні замовлення в статуси "Прийнято до оплати" і "Відправлений". Шаблони для листів знаходяться в папці shopkeeper/module/templates/.
- **Шаблон для контактної інформації** - шаблон докладного виду контактної інформації замовлення. Можна вказувати плейсхолдери тільки ті, які використовуються в шаблоні листа замовлення сніппета eForm (параметр `&report`), а також `[+orderData+] (склад замовлення)` і `[+orderID+] (номер замовлення)`.
- **Шаблон для контактної інформації в списку товарів** - шаблон для контактної інформації, яка відображається в таблиці замовлень.
Можна вказувати плейсхолдери тільки ті, які використовуються в шаблоні листа замовлення сніппета eForm (параметр &report), а також [+orderData+] (склад замовлення) і [+orderID+] (номер замовленя). 
За замовчуванням: `[+name+], [+address+], [+email+], [+phone+], [+delivery+], [+payment+]`
- **Кнопка "Видалити всі записи"** видаляє таблиці модуля із бази данних (деінсталяція).

## Шаблони, чанки і плейсхолдери ##
<table border="1" cellpadding="5">
<tbody><tr>
  <th>Найменування шаблона</th>
  <th>Плейсхолдери в шаблоні</th>
  <th>Примітка</th>
</tr>
<tr>
  <td>Шаблон для листа покупцеві про зміну статусу замовлення</td>
  <td rowspan="2">
    <b>[+date+]</b> - дата замовлення;<br>
    <b>[+site_name+]</b> - ім'я сайту;<br>
    <b>[+orderID+]</b> - номер замовлення;<br>
    <b>[+status+]</b> - статус замовлення;<br>
    <b>[+loop+]</b>/<b>[+end_loop+]</b> - початок і кінець рядка даних товарів (цикл);<br>
    <b>[+name+]</b> - назван товару;<br>
    <b>[+link+]</b> - силка на товар;<br>
    <b>[+price+]</b> - ціна товару<br>
    <b>[+addit_data+]</b> - список додаткових параметрів (використовується шаблон additData.tpl);<br>
    <b>[+count+]</b> - кількість одиниць товару;<br>
    <b>[+totalPrice+]</b> - загальна ціна;<br>
    <b>[+currency+]</b> - валюта;<br>
    <b>[+order_changed_txt+]</b> - текст (береться із мовного файла) виводиться, якщо склад замовлення був змінений менеджером магазину і один або більше товарів можна купити;<br>
    <b>[+order_notpossible_txt+]</b> - текст (береться із мовного файла) виводиьтся, якщо жоден з обраних товарів не можна купити;<br>
    <!--b>&#91;+if_changed+&#93;</b>/<b>&#91;+end_if+&#93;</b> - Текст між цих плейсхолдерів відправлятиметься, якщо склад замовлення був змінений менеджером (наприклад видалений якийсь товар).<br-->
    <b>[+contact+]</b> - Контактна информація (адрес, спосіб доставки і т.п.). Шаблон редагується в конфігурації модуля.
  </td>
  <td><b>shopkeeper/module/templates/mail_changeStatus.tpl</b></td>
</tr>
<tr>
  <td>Шаблон для письма покупцеві про відправку замовлення</td>
  <td><b>shopkeeper/module/templates/mail_shipped.tpl</b></td>
</tr>
<tr>
  <td>Шаблон для списку додаткових параметрів товару в листі</td>
  <td>
    <b>[+param+]</b> - ім'я та ціна параметра. Ціна вказується в дужках. Якщо ціна = 0, то пишеться тільки назва параметру (без дужок).<br>
    <b>[+name+]</b> - ім'я параметру.<br>
    <b>[+price+]</b> - ціна параметру.
  </td>
  <td><b>shopkeeper/module/templates/additData.tpl</b></td>
</tr>
</tbody></table>

## Каталог ##
Є можливість зберігати товари в каталозі Shopkeeper, а не в дереві документів.

Щоб в модулі Shopkeeper (в адмінці) з'явилося посилання "Каталог", потрібно в конфігурації вказати ID категорії каталогу (ID документа) за замовчуванням.
Також необхідно налаштувати конфігурацію плагіна SaveToSHK - вказати ID шаблону товарів і ID TV-параметра ціни.

У каталозі для переходу в іншу категорію потрібно натиснути на іконку поруч з назвою поточної категорії і вибрати в дереві документів нову. Потім натиснути на посилання категорії що з'явилася.

Для нормальної роботи каталогу Shopkeeper потрібно налаштувати плагін SaveToSHK. Вкажіть ID шаблону товарів і ID TV-параметра ціни.

## Облік кількості товарів на складі ##
Для того щоб покупець і власник магазину знали яка кількість товару є на складі, можна створити додатковий TV-параметр (наприклад inventory) з типом введення "Text". Далі в конфігурації модуля потрібно ввести ім'я TV в поле "Облік товару на складі (ім'я TV)". 

Після перекладу замовлення в статус "Відправлений" число цього параметра для кожного обраного товару буде автоматично перераховано. Якщо поле "Облік товару на складі" порожнє, кількість товарів на складі не враховується.

## Важливо ##
Для того щоб замовлення відправлялися в модуль, в виклик сніппета eForm додати параметри:
```
&eFormOnBeforeMailSent=`populateOrderData`
&eFormOnMailSent=`sendOrderToManager`
```


У чанку шаблону форми оформлення замовлення повинно бути приховане поле з назвою чанка тексту листа (reportTpl) 

```<input type="hidden" name="reportTpl" value="shopOrderReport" />```

### Приклад виклику eForm ###

```
[!eForm?
&formid=`shopOrderForm`
&tpl=`shopOrderForm`
&report=`shopOrderReport`
&vericode=`1`
&gotoid=`11`
&subject=`Замовлення в інтернет-магазині`
&eFormOnBeforeMailSent=`populateOrderData`
&eFormOnMailSent=`sendOrderToManager`
!] 
```

## Експорт замовленнь ##
В модулі є можливість експортувати список замовлень в CSV-файл. 

Якщо для відкриття ти використовуєте OpenOffice, відкрив файл, вкажіть параметр роздільника - "Точка з комою", кодування - "Кирилиця (Windows-1251)".
