## Опис ## 

Сніпет вивовить кошик замовлень двох типіп (розширений і простий). 

Сніпет можна викликати на сторінці декілька разів, але кошик виводиться тільки в місці першого виклика. Другий и наступні виклики ігноруються. 

**Приклад:**
*Якщо кошик на сторінках каталогу товарів знаходиться в правій колонці шаблона, а на сторінці оформлення заказу виклик сніпета вставлений в контент сторінки, то на цій сторінці кошик буде виведений тільки в центральній колонці (в правій виклик сніпета можна не прибирати).*

## Параметри сніпета ##
<table border="1" cellpadding="5">
<tbody><tr>
  <th>Параметр</th>
  <th>Опис і значення</th>
  <th>Значення за замовчуванням</th>
  <th>Примітка</th>
</tr>
<tr>
  <td><b>&lang</b></td>
  <td>мова</td>
  <td>Мова системи керування</td>
  <td>В данний час доступні мови:<br> `russian`, `english`, `german`, `francais`</td>
</tr>
<tr>
  <td><b>&style</b></td>
  <td>стиль кошика</td>
  <td>default<br> (assets/snippets/shopkeeper/style/default/)</td>
  <td><b>&style=`0`</b> - якщо не потрібен окремий стильовий файл для кошика</td>
</tr>
<tr>
  <td><b>&cartType</b></td>
  <td>
    тип кошика<br>
    <b>full</b> - розширений,<br>
    <b>small</b> - простий,<br>
    <b>empty</b> - тільки очистка кошика без виведення на сторінці
  </td>
  <td>full</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&currency</b></td>
  <td>валюта</td>
  <td>руб.</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&priceTV</b></td>
  <td>ім'я TV-параметру, який використовується для ціни.</td>
  <td>price</td>
  <td>Якщо ваш TV для ціни має назву не "price", <b>обов'язково</b> вкажіть це ім'я в даному параметрі.</td>
</tr>
<tr>
  <td><b>&orderFormPage</b></td>
  <td>ID сторінки з формою замовлення</td>
  <td>1</td>
  <td>обов'язковий параметр</td>
</tr>
<tr>
  <td><b>&noJQuery=`1`</b></td>
  <td>якщо на сайті вже використовується бібліотека JQuery</td>
  <td>0</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&noConflict=`1`</b></td>
  <td>если на сайті використовується інша JS-бібліотека (не JQuery), наприклад Mootools, Prototype.</td>
  <td>0</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&noCounter</b></td>
  <td>приховувати (значення `1`) або ні (значення `0`) лічильник товарів при додаванні в кошик</td>
  <td>0</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&linkAllow=`0`</b></td>
  <td>Виводить назви товарів в кошику без посилань.</td>
  <td>1</td>
  <td>Якщо цей параметр вказаний (=`0`) на сторінці оформлення заказу, лист з складом замовлення і список товарів в модулі будуть без посилань.</td>
</tr>
<tr>
  <td><b>&stuffCont</b></td>
  <td>CSS-селектор елемента, всередині якого знаходиться інформація про товар.</td>
  <td>div.shk-item</td>
  <td>Приклад чанка: chunk_shopStuff.tpl</td>
</tr>
<tr>
  <td><b>&debug=`1`</b></td>
  <td>запустити отладку JavaScript-функцій (виведення інформації)</td>
  <td>0</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&tplPath</b></td>
  <td>шлях до папки з чанками</td>
  <td>`assets/snippets/shopkeeper/chunks/ru/`</td>
  <td></td>
</tr>
<tr>
  <td><b>&cartTpl</b></td>
  <td>чанк з шаблоном кошика</td>
  <td>@FILE:chunk_shopCart.tpl</td>
  <td>Чанк вміщає одразу 3 шаблони - для порожнього, заповненого розширеного і простого кошика.<br> якщо чанки зберігаються в файлах, можно дізнатись шлях з командою "@FILE:". Якщо чанки створенні в системі управління, то вказується тільки ім'я чанка (наприклад &cartTpl=`shopCart`)</td>
</tr>
<tr>
  <td><b>&cartRowTpl</b></td>
  <td>чанк шаблону рядка з інформацією товару в розширеному кошику</td>
  <td>@FILE:chunk_shopCartRow.tpl</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&cartHelperTpl</b></td>
  <td>чанк шаблону "хелпера" - блок, який з'являється для підтвердження дій</td>
  <td>-</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&additDataTpl</b></td>
  <td>чанк для додаткових параметрів товарів в кошику ([+addit_data+])</td>
  <td>-</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&orderDataTpl</b></td>
  <td>чанк списку товарів в звіті про замовлення ([+orderData+])</td>
  <td>-</td>
  <td>Використовується в листі з звітом про замовлення (eForm &report) і в модулі.</td>
</tr>
<tr>
  <td><b>&flyToCart</b></td>
  <td>дія при додаванні товару в кошик.<br>
     <b>helper</b> - з'являється блок з лічильником кількості товарів і летить в кошик,<br>
     <b>image</b> - в кошик летить картинка товару<br>
     <b>nofly</b> - в кошик нічого не летить;
  </td>
  <td>`helper`</td>
  <td>При &flyToCart=`image` тег &lt;img&gt; повинен мати CSS-клас <b>"shk-image"</b></td>
</tr>
<tr>
  <td><b>&noLoader=`1`</b></td>
  <td>не показувати прелоадер (анімаційна картинка)</td>
  <td>0</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&excepDigitGroup=`1`</b></td>
  <td>розділяти числа цін в кошику на розряди</td>
  <td>1</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&changePrice=`1`</b></td>
  <td>при зміні параметрів з ціною - змінюється цвна товару, а індекс з плюсом не з'являється</td>
  <td>0</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&counterField=`1`</b></td>
  <td>додати до всіх полів &lt;input name="shk-count"&gt; (кількість товару) стрілки більше/менше</td>
  <td>0</td>
  <td>&nbsp;</td>
</tr>
<tr>
  <td><b>&noJavaScript=`1`</b></td>
  <td>Робота без JavaScript.</td>
  <td>0</td>
  <td>Зверніть увагу, що в чанку "shopCart" кнопка "Пересчитать" знаходиться всередині тега "noscript". Якщо використовується режим <b>&noJavaScript=`1`</b>, рекомендується тег "noscript" видалити.</td>
</tr>
<tr>
  <td><b>&hideOn</b></td>
  <td>Вимкнути кошик на сторінці</td>
  <td>0</td>
  <td>Зазвичай використовується в вивлику сніпета короткого виду кошику. Вказується ID сторніки з докладним видом кошика (оформление заказа). На этой странице краткий вид корзины будет отключен.</td>
</tr>
</tbody></table>

## Приклади ##

Простий виклик: 
```
[!Shopkeeper? &priceTV=`price` &orderFormPage=`10`!]
```

Розширений виклик:
```
[!Shopkeeper? 
&cartType=`small`
&priceTV=`price`
&orderFormPage=`10`
&changePrice=`1` 
&counterField=`1` 
&flyToCart=`nofly`
!]
```


## Шаблони (чанки) і плейсхолдери ##

<table border="1" cellpadding="5">
<tbody><tr>
  <th>Параметр сніпета</th>
  <th>Опис</th>
  <th>Плейсхолдери в шаблоні</th>
  <th>Примітка</th>
</tr>
<tr>
  <td><b>&cartTpl (&cartType=`full`)</b></td>
  <td>шаблон розширеного кошика</td>
  <td>
  <b>[+inner+]</b> - рядок з інформацією про товар (cartRowTpl);<br>
  <b>[+price_total+]</b> - Загальна сума;<br>
  <b>[+this_page_url+]</b> - URL поточної сторінки;<br>
  <b>[+empty_url+]</b> - URL для очистки кошика;<br>
  <b>[+order_page_url+]</b> - URL сторінки оформлення замовлення;<br>
  <b>[+currency+]</b> - валюта;
  </td>
  <td rowspan="2">
    Приклад: <b>chunk_shopCart.tpl</b>
    <br>(містить 3 шаблони кошика)<br><br>
    &lt;!--tpl_separator--&gt; - роздільник шаблонів (видаляти неможна)
  </td>
</tr>
<tr>
  <td><b>&cartTpl (&cartType=`small`)</b></td>
  <td>шаблон спрощеного кошика</td>
  <td>
  <b>[+price_total+]</b> - загальна сума;<br>
  <b>[+total_items+]</b> - Число обраних товарів;<br>
  <b>[+plural+]</b> - слово "товар" в множині залежно від числа выбранних товарів;<br>
  <b>[+this_page_url+]</b> - URL поточної сторінки;<br>
  <b>[+empty_url+]</b> - URL для очистки кошика;<br>
  <b>[+order_page_url+]</b> - URL сторінки оформлення замовлення;<br>
  <b>[+currency+]</b> - валюта
  </td>
</tr>
<tr>
  <td><b>&cartRowTpl</b></td>
  <td>шаблон рядка з інформацією про товар в розширеному кошику</td>
  <td>
  <b>[+id+]</b> - ID товару (документа);<br>
  <b>[+name+]</b> - назва товару;<br>
  <b>[+link+]</b> - посилання на сторінку товару;<br>
  <b>[+addit_data+]</b> - рядок з інформацією про додаткові параметри товару;<br>
  <b>[+price+]</b> - ціна;<br>
  <b>[+price_total+]</b> - ціна товару + додаткові параметри;<br>
  <b>[+price_count+]</b> - ціна товару * кількість;<br>
  <b>[+currency+]</b> - валюта;<br>
  <b>[+count+]</b> - кількість;<br>
  <b>[+this_page_url+]</b> - URL поточної сторінки;<br>
  <b>[+index+]</b> - номер товару в кошику (від нуля);<br>
  <b>[+будь-який TV+]</b> - будь-який TV-параметр, наприклад [+image+];<br>
  <b>[+shk_будь-який TV+]</b> - будь-який додатковий параметр, обраний при додаванні товарк в кошик (із [+addit_data+]), наприклад [+shk_param1+].
  </td>
  <td>Приклад: <b>chunk_shopCartRow.tpl</b> і <b>chunk_shopCartRow2.tpl</b></td>
</tr>
<tr>
  <td><b>&additDataTpl</b></td>
  <td>шаблон для додаткових параметрів товарів в кошику ([+addit_data+])</td>
  <td>
    <b>[+param+]</b> - ім'я і ціна параметру. Ціна вказується в дужках. Якщо ціна = 0, то пишеться тільки назва параметру (без дужок);<br>
    <b>[+name+]</b> - ім'я параметру;<br>
    <b>[+price+]</b> - ціна параметру;
  </td>
  <td>Приклад: <b>chunk_additDataTpl.tpl</b></td>
</tr>
<tr>
  <td><b>&orderDataTpl</b></td>
  <td>шаблон списку товарів в звіті про замовлення ([+orderData+])</td>
  <td>
    <b>Все плейсхолдери чанку &cartRowTpl</b><br><br>
    <b>[+loop+]</b>, <b>[+end_loop+]</b> - початок і кінець рядка даних товарів (цикл).
  </td>
  <td>Приклад: <b>chunk_orderDataTpl.tpl</b></td>
</tr>
<tr>
  <td><b>&report</b> (eForm)</td>
  <td>шаблон тексту листа з складу замовлення</td>
  <td>
  <b>[+orderData+]</b> - склад замовлення (список покупок);<br>
  <b>[+orderID+]</b> - номер замовлення;
  </td>
  <td>Приклад: <b>chunk_shopOrderReport.tpl</b> і <b>chunk_shopOrderReportWebUser.tpl</b></td>
</tr>
<tr>
  <td>Сторінка, на якій викликається сніпет Shopkeeper</td>
  <td></td>
  <td>
  <b>[+totalItems+]</b> - кількість товару в кошику;<br>
  <b>[+totalPrice+]</b> - загальна ціна товару в кошику;
  </td>
  <td></td>
</tr>
</tbody></table>



## Необхідні CSS-класи, Id і імена полів ## 
Для повноцінної работи Shopkeeper необхідні наступні css-класи, id і імена полів:

<table border="1" cellpadding="5">
<tbody><tr>
  <th>Шаблон</th>
  <th>CSS-класи</th>
  <th>id HTML-елементів</th>
  <th>Імена полів s кнопок</th>
  <th>Примітка</th>
</tr>
<tr>
  <td>Шаблон виведення інформації товару</td>
  <td>
    <b>shk-item</b> - клас "обертаючого" елементу блока з інформацією про товар;<br>
    <b>shk-image</b> - картинка товару (якщо використовується &flyToCart=`image`);<br>
    <b>shk-price</b> -клас элементу з ціною товару.<br>
  </td>
  <td>—</td>
  <td>
    <b>shk-id</b> - ім'я прихованого поля з id товару;<br>
    <b>shk-count</b> - ім'я прихованого поля з кількістю товару.
  </td>
  <td>Приклад <b>chunk_shopStuff.tpl</b></td>
</tr>
<tr>
  <td>Шаблон кошика</td>
  <td>
    —
  </td>
  <td>
    <b>shopCart</b> - id "огортаючого" елемента блоку кошика;<br>
    <b>butEmptyCart</b> - id кнопки-силки очистки кошика;<br>
    <b>butOrder</b> - id посилання на сторінку оформлення товару.
  </td>
  <td>
    <b>shk_recount</b> - кнопка "Перерахувати".<br>
    
  </td>
  <td>Приклад <b>chunk_shopCart.tpl</b></td>
</tr>
<tr>
  <td>Шаблон рядка інформації про товар в кошику</td>
  <td>
    <b>shk-del</b> - кнопка-посилання видалення товару.<br>
    
  </td>
  <td>
    —
  </td>
  <td>
    <b>count[]</b> - ім'я полей з кількістью товару.<br>
  </td>
  <td>Приклад <b>chunk_shopCartRow.tpl</b></td>
</tr>
<tr>
  <td>Шаблон форми замовлення</td>
  <td>
    —
  </td>
  <td>
    —
  </td>
  <td>
    <b>email</b> - поле "E-mail";<br>
    <b>phone</b> - поле "Телефон"
  </td>
  <td>Приклад <b>chunk_shopOrderForm.tpl</b> і <b>chunk_shopOrderFormWebUser.tpl</b></td>
</tr>
</tbody></table>

CSS-класи (і id) використовуються в JS-функціях Shopkeeper'а.


## Поради ##
### Дві і більше ціни для одного товару ##
Для цього потрібно створити дві або більше форми (form) і в полі name="shk-id" після ID написати ім'я TV з ціною.

**Приклад:**
```
<input type="hidden" name="shk-id" value="[+id+]__price2">
```

При submit форми в корзині додасться ціна з TV-параметру з іменем "price2".

### Додавання в кошик даних, не створюючи TV-параметри ###

**Приклад:**
```
<input type="text" name="test__[*id*]__add" value="додаткові дані" />
```
В кошик додасться параметр, який можна виводити в месці вставки плейсхолдера `[+test+]` (виведетсья "додаткові дані").


## Події для плагінів ##

* OnSHKFrontendInit - ініціалізація сніпета Shopkeeper в зовнішній частині.
* OnSHKChangeStatus - зміна статусу замовлення.
* OnSHKOrderDescRender - виведення докладної информації про замовлення в модулі.
* OnSHKMailApprovedForPayment - відправка листа при статусі "Прийнятий до оплати". Плагін може додавати в лист додаткову інформацію `([+plugin+])`.
* OnSHKcartLoad - завантаження кошика (вивід інформації в чанку `&cartTpl - [+plugin+]`).
* OnSHKstatusSendMail - відправка листа про зміну статусу.
* OnSHKmodRenderTopLinks - вивід силок у верхній частині в модуля Shopkeeper.
* OnSHKmodPagePrint - вивід сторінки модуля. Можна використовувати для створення своєї сторінки(див. приклад OnSHKmodPagePrint_plugin_example.txt).
* OnSHKbeforeSendOrder - перед відправленням замовлення. Можна використовувати для зміни полів ($fields).
* OnSHKsaveOrder - збереження замовлення.
* OnSHKcalcTotalPrice - розрахунок загальної вартості.

В папці shopkeeper/docs/ є приклади плагінів.


## "Сallback-функції" на JavaScript ## 
* setCartActionsCallback - перезавантаження кошика,
* fillCartCallback - додавання товару в кошик,
* emptyCartCallback - очищення кошику.

Просто створіть функції з такими іменами і вони будуть викликатися при відповідних діях.


## Приклади чанків в папці install/examples/ ##

* chunk_shopCart.tpl - чанк кошика. Може бути використаний як значення параметру & cartTpl при виклику Shopkeeper. Чанк містить відразу 3 шаблони - для порожнього, заполненого расширеного і заполненого простого кошика.
* chunk_shopCartRow.tpl - чанк шаблону рядки з інформацією товару в розширеній кошику.
* chunk_shopCartRow2.tpl - приклад з картинкою (TV - image) и умовою PHx.
* chunk_shopStuff.tpl - чанк короткої інформації про товар. Може бути використаний як значення параметру & tpl при виклику Ditto.
* chunk_shopStuff_2.tpl - приклад з двома цінами для одного товару (продаж і прокат).
* chunk_shopToCart.tpl - може бути використаний в шаблоні сторінки докладного опису товару або можна вставляти виклик чанку `{{shopToCart}}` в візуальний редактор.
* chunk_shopCartHelper.tpl - чанк шаблону "хелпера" - блока, який з'являється для підтвердження дій.
* chunk_additDataTpl.tpl - шаблон для додаткових параметрів товарів в кошику.
* chunk_shopOrderForm.tpl - чанк форма оформлення замовлення. Може бути використаний як значення параметру &tpl при виклику eForm.
* chunk_shopOrderFormWebUser.tpl - чанк форма оформлення замовлення для зареєстрованих користувачів.
* chunk_shopOrderReport.tpl - чанк листа з інформацією про замовлення. Може бути використаний як значення параметра &report при виклику eForm.
* chunk_shopOrderReportWebUser.tpl - чанк листа з інформацією про замовлення для зареєстрованих користувачів.
* chunk_FormSignup.tpl - приклад чанка з шаблоном форми реєстрації для сніпета WebSignup.
* chunk_weblogin.tpl - приклад чанка з шаблоном форми авторизації сніпета WebLogin.
* chunk_orderDataTpl.tpl - шаблон списку товарів в звіті про замовлення `([+orderData+])`
